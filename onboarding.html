<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome — OroFlow</title>
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}html{-webkit-font-smoothing:antialiased}body{font-family:'Outfit',sans-serif;background:#f5f5f0;background-image:radial-gradient(circle,#d5d5cf 1px,transparent 1px);background-size:28px 28px;background-attachment:fixed;color:#1a1a1a;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}h1,h2,h3{font-family:'Space Grotesk',sans-serif;letter-spacing:-.03em}
.onboard-container{width:100%;max-width:540px;animation:fadeIn .5s cubic-bezier(.4,0,.2,1)}
.card{background:#ffffff;border:1px solid #e0e0da;border-radius:20px;padding:44px 36px;box-shadow:0 2px 8px rgba(0,0,0,.06),0 8px 32px rgba(0,0,0,.06)}
.brand{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:28px;text-decoration:none}
.brand-logo{width:38px;height:38px;background:#1a1a1a;border-radius:9px;display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:13px;color:#E2FF00}
.brand-name{font-family:'Space Grotesk',sans-serif;font-size:22px;font-weight:800;color:#1a1a1a;letter-spacing:-.04em}
.card h1{font-size:26px;font-weight:800;text-align:center;margin-bottom:6px;letter-spacing:-.04em}
.card .subtitle{text-align:center;color:#888;font-size:14px;margin-bottom:8px}
.progress-bar{width:100%;height:4px;background:#e0e0da;border-radius:2px;margin:20px 0 28px;overflow:hidden}
.progress-fill{height:100%;background:#1a1a1a;border-radius:2px;transition:width .4s cubic-bezier(.4,0,.2,1)}
.step-label{text-align:center;font-size:12px;color:#888;margin-bottom:24px;font-weight:500}
.industry-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:24px}
.industry-card{background:#f5f5f0;border:1px solid #e0e0da;border-radius:12px;padding:18px 12px;text-align:center;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1)}
.industry-card:hover{border-color:#1a1a1a;transform:translateY(-2px)}
.industry-card.selected{background:#1a1a1a;color:#E2FF00;border-color:#1a1a1a}
.industry-card .ic-icon{font-size:24px;margin-bottom:6px;display:block}
.industry-card .ic-name{font-size:12px;font-weight:600}
.suggest-section{margin-bottom:24px}
.suggest-label{font-size:13px;font-weight:600;color:#555;margin-bottom:8px}
.suggest-pills{display:flex;flex-wrap:wrap;gap:6px}
.suggest-pill{padding:6px 12px;background:#f5f5f0;border:1px solid #e0e0da;border-radius:8px;font-size:11px;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);color:#555}
.suggest-pill:hover{border-color:#1a1a1a;color:#1a1a1a}
.suggest-pill.selected{background:#1a1a1a;color:#E2FF00;border-color:#1a1a1a}
.btn-continue{width:100%;padding:13px;background:#e0e0da;color:#888;border:none;border-radius:11px;font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:700;cursor:not-allowed;transition:all .25s cubic-bezier(.4,0,.2,1)}
.btn-continue.active{background:#1a1a1a;color:#E2FF00;cursor:pointer}
.btn-continue.active:hover{background:#111;box-shadow:0 4px 20px rgba(0,0,0,.15);transform:translateY(-1px)}
.btn-skip{display:block;text-align:center;margin-top:16px;color:#888;font-size:13px;text-decoration:none;transition:all .25s cubic-bezier(.4,0,.2,1)}
.btn-skip:hover{color:#1a1a1a}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:480px){.card{padding:32px 22px;border-radius:16px}.industry-grid{grid-template-columns:repeat(2,1fr)}.card h1{font-size:23px}}
</style>
</head>
<body>
<div class="onboard-container">
<div class="card">
<div class="brand"><div class="brand-logo">O+</div><span class="brand-name">OroFlow</span></div>
<h1>Tell Us About You</h1>
<p class="subtitle">Help us tailor workflows to your industry</p>
<div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:66%"></div></div>
<p class="step-label">Step 2 of 3 — Choose your industry</p>
<div class="industry-grid" id="industryGrid">
<div class="industry-card" data-val="security" onclick="selectIndustry(this)"><span class="ic-icon">&#128737;</span><span class="ic-name">Security</span></div>
<div class="industry-card" data-val="realestate" onclick="selectIndustry(this)"><span class="ic-icon">&#127968;</span><span class="ic-name">Real Estate</span></div>
<div class="industry-card" data-val="fnb" onclick="selectIndustry(this)"><span class="ic-icon">&#127860;</span><span class="ic-name">F&B</span></div>
<div class="industry-card" data-val="retail" onclick="selectIndustry(this)"><span class="ic-icon">&#128722;</span><span class="ic-name">Retail</span></div>
<div class="industry-card" data-val="healthcare" onclick="selectIndustry(this)"><span class="ic-icon">&#128138;</span><span class="ic-name">Healthcare</span></div>
<div class="industry-card" data-val="other" onclick="selectIndustry(this)"><span class="ic-icon">&#128188;</span><span class="ic-name">Other</span></div>
</div>
<div class="suggest-section">
<div class="suggest-label">What do you want to automate?</div>
<div class="suggest-pills">
<span class="suggest-pill" onclick="togglePill(this)">Guard check-ins</span>
<span class="suggest-pill" onclick="togglePill(this)">Reports</span>
<span class="suggest-pill" onclick="togglePill(this)">Invoicing</span>
<span class="suggest-pill" onclick="togglePill(this)">Lead capture</span>
<span class="suggest-pill" onclick="togglePill(this)">Notifications</span>
<span class="suggest-pill" onclick="togglePill(this)">Scheduling</span>
</div>
</div>
<button class="btn-continue" id="continueBtn" onclick="saveAndContinue()">Continue to Dashboard</button>
<a href="/dashboard.html" class="btn-skip">Skip for now &rarr;</a>
</div>
</div>

<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ============================================
// SUPABASE INIT
// ============================================
var SUPABASE_URL = 'https://xsqfdhymfgrobzovfgjf.supabase.co';
var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzcWZkaHltZmdyb2J6b3ZmZ2pmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwODA3MTgsImV4cCI6MjA4NzY1NjcxOH0.D4SqSsR8O8HAwjHFr03hYc1NcPHsqLQnJT3jH1yaMpU';
var sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ============================================
// AUTH GUARD — redirect to login if not signed in
// ============================================
// This page should only be accessible after signup.
// If someone navigates here directly without a session,
// we send them to login.
var currentUser = null;
(async function checkAuth() {
    var result = await sb.auth.getSession();
    if (!result.data.session) {
        window.location.href = '/login.html';
        return;
    }
    currentUser = result.data.session.user;
})();

// ============================================
// INDUSTRY SELECTION
// ============================================
var selectedIndustry = '';

function selectIndustry(el) {
    document.querySelectorAll('.industry-card').forEach(function(c) {
        c.classList.remove('selected');
    });
    el.classList.add('selected');
    selectedIndustry = el.getAttribute('data-val');
    document.getElementById('continueBtn').classList.add('active');
}

function togglePill(el) {
    el.classList.toggle('selected');
}

// ============================================
// SAVE & CONTINUE
// ============================================
// Replaces: fetch('/save-industry.php', ...)
//
// This updates the user's oroflow_profiles row with:
// - industry: the selected industry card value
// - notes: comma-separated list of selected automation interests
//
// The RLS policy "Users can update own oroflow profile" allows
// this because auth.uid() matches the profile's id.
async function saveAndContinue() {
    if (!selectedIndustry) return;
    if (!currentUser) return;

    var btn = document.getElementById('continueBtn');
    btn.textContent = 'Setting up...';

    // Collect selected automation pills
    var selectedPills = [];
    document.querySelectorAll('.suggest-pill.selected').forEach(function(p) {
        selectedPills.push(p.textContent);
    });

    // Update the user's profile in Supabase
    // .eq('id', currentUser.id) ensures we only update OUR row
    // RLS double-checks this server-side
    await sb
        .from('oroflow_profiles')
        .update({
            industry: selectedIndustry,
            notes: selectedPills.length > 0 ? selectedPills.join(', ') : null
        })
        .eq('id', currentUser.id);

    // Animate progress bar to 100% then redirect
    document.getElementById('progressFill').style.width = '100%';
    setTimeout(function() {
        window.location.href = '/dashboard.html';
    }, 500);
}
</script>
</body>
</html>
