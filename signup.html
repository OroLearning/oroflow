<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up — OroFlow</title>
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}html{-webkit-font-smoothing:antialiased}body{font-family:'Outfit',sans-serif;background:#f5f5f0;background-image:radial-gradient(circle,#d5d5cf 1px,transparent 1px);background-size:28px 28px;background-attachment:fixed;color:#1a1a1a;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}h1,h2,h3{font-family:'Space Grotesk',sans-serif;letter-spacing:-.03em}
.signup-container{width:100%;max-width:420px;animation:fadeIn .5s cubic-bezier(.4,0,.2,1)}
.card{background:#ffffff;border:1px solid #e0e0da;border-radius:20px;padding:44px 36px;box-shadow:0 2px 8px rgba(0,0,0,.06),0 8px 32px rgba(0,0,0,.06)}
.brand{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:32px;text-decoration:none}
.brand-logo{width:38px;height:38px;background:#1a1a1a;border-radius:9px;display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:13px;color:#E2FF00;transition:all .25s cubic-bezier(.4,0,.2,1)}
.brand:hover .brand-logo{box-shadow:0 0 0 3px rgba(226,255,0,.10)}
.brand-name{font-family:'Space Grotesk',sans-serif;font-size:22px;font-weight:800;color:#1a1a1a;letter-spacing:-.04em}
.card h1{font-size:26px;font-weight:800;text-align:center;margin-bottom:6px;letter-spacing:-.04em}
.card .subtitle{text-align:center;color:#888;font-size:14px;margin-bottom:28px;font-weight:400}
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:13px;font-weight:600;color:#555;margin-bottom:7px}
.form-group input{width:100%;padding:12px 15px;background:#f5f5f0;border:1px solid #e0e0da;border-radius:10px;color:#1a1a1a;font-family:'Outfit',sans-serif;font-size:14px;transition:all .25s cubic-bezier(.4,0,.2,1);outline:none}
.form-group input::placeholder{color:#888}
.form-group input:focus{border-color:#1a1a1a;box-shadow:0 0 0 3px rgba(226,255,0,.10)}
.btn-submit{width:100%;padding:13px;background:#1a1a1a;color:#E2FF00;border:none;border-radius:11px;font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);margin-top:6px}
.btn-submit:hover{background:#111;box-shadow:0 4px 20px rgba(0,0,0,.15);transform:translateY(-1px)}
.btn-submit:active{transform:translateY(0)}
.btn-submit:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}
.alt-link{text-align:center;margin-top:22px;color:#888;font-size:14px}
.alt-link a{color:#1a1a1a;text-decoration:none;font-weight:600;transition:all .25s cubic-bezier(.4,0,.2,1)}
.alt-link a:hover{color:#111}
.legal{text-align:center;margin-top:16px;font-size:12px;color:#888}
.legal a{color:#555;text-decoration:none;margin:0 3px}
.legal a:hover{text-decoration:underline}
.error-msg{background:rgba(220,38,38,.06);border:1px solid rgba(220,38,38,.12);color:#dc2626;padding:11px 14px;border-radius:10px;font-size:13px;margin-bottom:18px;display:none;text-align:center;font-weight:500}
.pw-hint{font-size:11px;color:#888;margin-top:5px}
.pw-wrapper{position:relative}
.pw-wrapper input{width:100%;padding-right:44px}
.pw-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#888;font-size:16px;padding:4px;line-height:1;transition:color .2s}
.pw-toggle:hover{color:#1a1a1a}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:480px){.card{padding:32px 22px;border-radius:16px}.card h1{font-size:23px}}
</style>
</head>
<body>
<div class="signup-container">
<div class="card">
<a href="/" class="brand"><div class="brand-logo">O+</div><span class="brand-name">OroFlow</span></a>
<h1>Create Account</h1>
<p class="subtitle">Start automating your business today</p>
<div class="error-msg" id="errorMsg"></div>
<form id="signupForm" onsubmit="return handleSignup(event)">
<div class="form-group"><label>Full Name</label><input type="text" id="name" placeholder="Your full name" required></div>
<div class="form-group"><label>Email Address</label><input type="email" id="email" placeholder="you@company.com" required></div>
<div class="form-group"><label>Password</label><div class="pw-wrapper"><input type="password" id="password" placeholder="Create a password" required minlength="8"><button type="button" class="pw-toggle" onclick="togglePw(this)">&#128065;</button></div><div class="pw-hint">Minimum 8 characters</div></div>
<button type="submit" class="btn-submit" id="submitBtn">Create Account</button>
</form>
<p class="alt-link">Already have an account? <a href="/login.html">Sign in</a></p>
<p class="legal">By signing up you agree to our <a href="/terms.html">Terms</a> and <a href="/privacy.html">Privacy Policy</a></p>
</div>
</div>

<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.1/dist/umd/supabase.min.js"></script>
<script>
// ============================================
// SUPABASE INIT
// ============================================
var SUPABASE_URL = 'https://xsqfdhymfgrobzovfgjf.supabase.co';
var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzcWZkaHltZmdyb2J6b3ZmZ2pmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwODA3MTgsImV4cCI6MjA4NzY1NjcxOH0.D4SqSsR8O8HAwjHFr03hYc1NcPHsqLQnJT3jH1yaMpU';
var sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function togglePw(btn) {
    var input = btn.previousElementSibling;
    if (input.type === 'password') {
        input.type = 'text';
        btn.innerHTML = '&#128064;';
    } else {
        input.type = 'password';
        btn.innerHTML = '&#128065;';
    }
}

// ============================================
// AUTO-REDIRECT IF ALREADY LOGGED IN
// ============================================
// Replaces: fetch('/auth.php?action=check')
(async function checkExistingSession() {
    var result = await sb.auth.getSession();
    if (result.data.session) {
        window.location.href = '/dashboard.html';
    }
})();

// ============================================
// SIGNUP HANDLER
// ============================================
// Replaces: fetch('/auth.php?action=signup', ...)
//
// How Supabase signUp works:
// 1. Creates a row in auth.users with email + hashed password
// 2. Stores the 'name' in raw_user_meta_data (accessible later)
// 3. Our trigger (handle_oroflow_signup) fires automatically
//    and creates a row in oroflow_profiles with:
//    - id = the new user's UUID
//    - email = their email
//    - name = from raw_user_meta_data
//    - plan = 'free'
// 4. Supabase returns a session (JWT token) stored in localStorage
// 5. We redirect to onboarding for industry selection
async function handleSignup(e) {
    e.preventDefault();

    var btn = document.getElementById('submitBtn');
    var errEl = document.getElementById('errorMsg');

    // Reset UI
    errEl.style.display = 'none';

    var name = document.getElementById('name').value.trim();
    var email = document.getElementById('email').value.trim().toLowerCase();
    var password = document.getElementById('password').value;

    // Client-side validation
    if (password.length < 8) {
        errEl.textContent = 'Password must be at least 8 characters.';
        errEl.style.display = 'block';
        return false;
    }

    btn.disabled = true;
    btn.textContent = 'Creating account...';

    // Call Supabase Auth signUp
    // The 'data.name' in options gets stored in raw_user_meta_data
    // which our trigger reads to populate oroflow_profiles.name
    var result = await sb.auth.signUp({
        email: email,
        password: password,
        options: {
            data: {
                name: name
            }
        }
    });

    if (result.error) {
        // Map common Supabase errors to friendly messages
        var msg = result.error.message;
        if (msg.includes('already registered')) {
            msg = 'An account with this email already exists.';
        } else if (msg.includes('valid email')) {
            msg = 'Please enter a valid email address.';
        } else if (msg.includes('at least')) {
            msg = 'Password must be at least 8 characters.';
        }
        errEl.textContent = msg;
        errEl.style.display = 'block';
        btn.disabled = false;
        btn.textContent = 'Create Account';
    } else {
        // Success — user created + session stored + profile auto-created
        // Redirect to onboarding for industry selection
        window.location.href = '/onboarding.html';
    }

    return false;
}
</script>
</body>
</html>
